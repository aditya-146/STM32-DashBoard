#include "SpeedBtns.h"

void SpeedCalculate(int *Speed)
{
    int accel_pressed = HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_4) == GPIO_PIN_SET;
    int brake_pressed = HAL_GPIO_ReadPin(GPIOB, GPIO_PIN_5) == GPIO_PIN_SET;

    /* Acceleration */
    if(accel_pressed && (*Speed) < MAX_SPEED)
    {
        (*Speed) += ACCEL_STEP;

        if((*Speed) > MAX_SPEED)
            (*Speed) = MAX_SPEED;
    }

    /* Braking */
    else if(brake_pressed && (*Speed) > 0)
    {
        if((*Speed) < BRAKE_THRESHOLD)
            (*Speed) = 0;
        else
            (*Speed) -= BRAKE_STEP;
    }

    /* Natural deceleration */
    else if((*Speed) > 0)
    {
        (*Speed) -= NATURAL_DECAY;
    }
}

